<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">流媒体 | WangQuan 的个人网站</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://wangquanwwq.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://wangquanwwq.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://wangquanwwq.github.io/blog/2025/07/10/流媒体"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="流媒体 | WangQuan 的个人网站"><meta data-rh="true" name="description" content="ffmpeg"><meta data-rh="true" property="og:description" content="ffmpeg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-07-10T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/WangQuanWWQ"><meta data-rh="true" property="article:tag" content="Learn,Note"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wangquanwwq.github.io/blog/2025/07/10/流媒体"><link data-rh="true" rel="alternate" href="https://wangquanwwq.github.io/blog/2025/07/10/流媒体" hreflang="en"><link data-rh="true" rel="alternate" href="https://wangquanwwq.github.io/blog/2025/07/10/流媒体" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://wangquanwwq.github.io/blog/2025/07/10/流媒体","mainEntityOfPage":"https://wangquanwwq.github.io/blog/2025/07/10/流媒体","url":"https://wangquanwwq.github.io/blog/2025/07/10/流媒体","headline":"流媒体","name":"流媒体","description":"ffmpeg","datePublished":"2025-07-10T00:00:00.000Z","author":{"@type":"Person","name":"Wang Quan","description":"Docusaurus maintainer","url":"https://github.com/WangQuanWWQ","image":"https://avatars.githubusercontent.com/u/76089741?v=4"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://wangquanwwq.github.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="WangQuan 的个人网站 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="WangQuan 的个人网站 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.cf78aa0b.css">
<script src="/assets/js/runtime~main.81679921.js" defer="defer"></script>
<script src="/assets/js/main.9ea156e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/76089741?v=4"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">WangQuan 的个人网站</b></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/WangQuanWWQ/my-blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">全部</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/07/10/docker安装oracle23">docker安装oracle23</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/07/10/hexo部署">hexo部署</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2025/07/10/创建git笔记仓库">创建git笔记仓库</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2025/07/10/流媒体">流媒体</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">流媒体</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-07-10T00:00:00.000Z">July 10, 2025</time> · <!-- -->26 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/blog/authors/wangquan"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/76089741?v=4" alt="Wang Quan"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/blog/authors/wangquan"><span class="authorName_yefp">Wang Quan</span></a></div><small class="authorTitle_nd0D" title="Docusaurus maintainer">Docusaurus maintainer</small><div class="authorSocials_rSDt"><a href="https://github.com/WangQuanWWQ" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a><a href="https://thisweekinreact.com" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="newsletter"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="authorSocialLink_owbf"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path><path d="M3.6 9h16.8"></path><path d="M3.6 15h16.8"></path><path d="M11.5 3a17 17 0 0 0 0 18"></path><path d="M12.5 3a17 17 0 0 1 0 18"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ffmpeg">ffmpeg<a href="#ffmpeg" class="hash-link" aria-label="Direct link to ffmpeg" title="Direct link to ffmpeg">​</a></h2>
<blockquote>
<p>ffmpeg 是用于处理音频、视频、字幕和相关元数据等多媒体内容的库和工具的集合。</p>
<ul>
<li>安装 <a href="https://www.tecmint.com/install-ffmpeg-in-linux/" target="_blank" rel="noopener noreferrer">https://www.tecmint.com/install-ffmpeg-in-linux/</a></li>
</ul>
</blockquote>
<blockquote>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -i car-brand.MOV -rtsp_transport tcp -vcodec h264 -f rtsp rtsp://localhost/test</span><br></span></code></pre></div></div>
<ul>
<li>命令</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -i rtsp://admin:root123@192.168.66.119/ -vcodec copy -acodec copy  -rtsp_transport tcp -f rtsp rtsp://127.0.0.1/test.sdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 音视频转码后推送</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -i rtsp://admin:root123@192.168.66.119/ -vcodec libx264 -acodec libvo_aacenc  -rtsp_transport tcp -f rtsp rtsp://127.0.0.1/test.sdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -i ./car-brand.MOV -stream_loop -1  -vcodec libx264 -acodec aac -f rtsp rtsp://10.159.11.167:8194/car-brand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -i ./car-brand.MOV -rtsp_transport tcp -vcodec h264 -f rtsp rtsp://localhost/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -i ./car-brand.MOV -rtsp_transport udp -vcodec h264 -f rtsp rtsp://localhost/test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -stream_loop -1 -i carbrand.MOV -rtsp_transport tcp -vcodec h264 -f rtsp rtsp://localhost/test1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -re -stream_loop -1 -i carbrand.MOV -c copy                          -f rtsp rtsp://localhost:8554/mystream</span><br></span></code></pre></div></div>
<ul>
<li>ffmpeg参数</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 参考文档 https://ffmpeg.org/ffmpeg.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Main options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Force input or output file format. The format is normally auto detected for input files and guessed from the file extension for output files, so this option is not needed in most cases.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-f fmt              force format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Select an encoder (when used before an output file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or a decoder (when used before an input file) for one or more streams.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># codec is the name of a decoder/encoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or a special value copy (output only) to indicate that the stream is not to be re-encoded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-c codec            codec name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-codec codec        codec name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># input file url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-i url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set number of times input stream shall be looped. Loop 0 means no loop, loop -1 means infinite loop.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># -1 无限循环</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-stream_loop number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Video options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r rate             set frame rate (Hz value, fraction or abbreviation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-vcodec codec       force video codec (&#x27;copy&#x27; to copy stream)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Audio options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-acodec codec       force audio codec (&#x27;copy&#x27; to copy stream)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Read input at native frame rate. Mainly used to simulate a grab device, or live input stream (e.g. when reading from a file).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 用来模拟一个摄像头或者实时流，不要在正式环境使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-re</span><br></span></code></pre></div></div>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gb28181">GB28181<a href="#gb28181" class="hash-link" aria-label="Direct link to GB28181" title="Direct link to GB28181">​</a></h2>
<blockquote>
<p>[!note]</p>
<p>GB28181 协议是设备端主动向服务端发起注册消息，并定时发送保活消息，服务端收到后就认为设备在线，超时收不到保活的话就认为设备离线了。客户端发起播放视频请求时，服务端给指定的设备发送 INVITE 请求，通知设备将指定的通道的视频推送到服务端，服务端再转发给客户端，用户就可以播放了。</p>
<p>GB28181 传输协议是 RTP，去掉 RTP 头部，剩余数据为 H264 PS 流，可使用 VLC 直接播放</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gb28181-报文">GB28181 报文<a href="#gb28181-报文" class="hash-link" aria-label="Direct link to GB28181 报文" title="Direct link to GB28181 报文">​</a></h3>
<blockquote>
<p>[!note]</p>
<p>国标 IPC 的 IP 为 192.168.10.8， IPC 本地 SIP 端口为 60719， SIP ID 为 34020000002000000719；</p>
<p>SIP 服务器的 IP 为 192.168.10.10， SIP 服务器的端口为 57030， SIP ID 为 34020000002000000001。</p>
<p>整个国标信令部分基于 UDP 协议进行传输。</p>
<p>开发基于 <a href="https://github.com/resiprocate/resiprocate" target="_blank" rel="noopener noreferrer">resiprocate/resiprocate</a></p>
<ol>
<li>注册（REGISTER）</li>
<li>注销（CANCEL）</li>
<li>心跳（Keepalive）</li>
<li>INVITE</li>
<li>云台控制（PTZ）</li>
</ol>
<p>在 GB28181 的 2016 版中，对于媒体流的传输在原有 <strong>UDP 传输</strong>的基础中，增加了<strong>主动 tcp</strong> 和<strong>被动 tcp</strong> 的方式。</p>
<ul>
<li>
<p>UDP</p>
<p>GB28181 服务端在发 invite 时，在携带的 SDP 中包含了接收媒体的端口，设备端（被呼叫端）收到 invite 后，解析该端口，通过 UDP 将媒体流发向该端口。</p>
</li>
<li>
<p>TCP被动</p>
<p>GB28181 服务端在发 invite 时，在携带的 SDP 中包含了接收媒体的端口，并监听该端口的媒体数据，设备端（被呼叫端）收到 invite 后，解析该端口，通过 TCP 将媒体流发向该端口。</p>
</li>
<li>
<p>TCP主动</p>
<p>设备端（被呼叫端）告知服务端自己的媒体流 tcp 端口，服务端主动去连接设备端（被呼叫端）的该端口，获取数据。</p>
</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gb28181的协议栈实现">GB28181的协议栈实现<a href="#gb28181的协议栈实现" class="hash-link" aria-label="Direct link to GB28181的协议栈实现" title="Direct link to GB28181的协议栈实现">​</a></h3>
<blockquote>
<p>[!note]</p>
<p>GB/T-28181 协议其实就是在国际上通用的 <code>SIP 协议进行私有化定制</code>， 流媒体方面就是在国际最流行的编码上进行封装（当然也有我们国家的编码标准 <code>SVAC</code>）。</p>
<p><code>libosip + libexosip + libxml</code> 来实现 IPC 和平台协议功能，前面两者负责 sip 协议的实现，libxml 用来封装和解析实体信令。通过 3~4 年的市场应用感觉挺稳定的。</p>
<p>流媒体方面：从编码中获取的 <code>h.264 + g711</code> 的视音频帧，进行 PS 媒体协议封装（自己写的 PS 封装协议），再经过 RTP 传输协议（自己实现）发送至平台。</p>
<p>平台对收到的 RTP 流媒体进行解 RTP, 解 PS，再进行 <code>h.264 + g711</code> 的解码。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip协议">SIP协议<a href="#sip协议" class="hash-link" aria-label="Direct link to SIP协议" title="Direct link to SIP协议">​</a></h3>
<blockquote>
<p>[!note]</p>
<p>会话初始协议</p>
<p>SIP 协议是一个应用层的点对点协议，用于初始、管理和终止网络中的语音和视频会话，是 <code>GB28181</code> 的核心之一。</p>
<p>会话发起协议（ Session Initiation Protocol，缩写  SIP）是一个由  <a href="https://www.wikiwand.com/zh-cn/IETF" target="_blank" rel="noopener noreferrer">IETF</a> <a href="https://web.archive.org/web/20051206085212/http://www.ietf.org/html.charters/mmusic-charter.html" target="_blank" rel="noopener noreferrer">MMUSIC 工作组</a>开发的协议，作为标准被提议用于创建，修改和终止包括视频，语音，<a href="https://www.wikiwand.com/zh-cn/%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1" target="_blank" rel="noopener noreferrer">即时通信</a>，<a href="https://www.wikiwand.com/zh-cn/%E5%9C%A8%E7%BA%BF%E6%B8%B8%E6%88%8F" target="_blank" rel="noopener noreferrer">在线游戏</a>和<a href="https://www.wikiwand.com/zh-cn/%E8%99%9A%E6%8B%9F%E7%8E%B0%E5%AE%9E" target="_blank" rel="noopener noreferrer">虚拟现实</a>等多种多媒体元素在内的交互式用户会话。2000 年 11 月，SIP 被正式批准成为  <a href="https://www.wikiwand.com/zh-cn/3GPP" target="_blank" rel="noopener noreferrer">3GPP</a> 信号协议之一，并成为  <a href="https://www.wikiwand.com/zh-cn/IP%E5%A4%9A%E5%AA%92%E4%BD%93%E5%AD%90%E7%B3%BB%E7%BB%9F" target="_blank" rel="noopener noreferrer">IMS</a> 体系结构的一个永久单元。SIP 与  <a href="https://www.wikiwand.com/zh-cn/H.323" target="_blank" rel="noopener noreferrer">H.323</a> 一样，是用于  <a href="https://www.wikiwand.com/zh-cn/VoIP" target="_blank" rel="noopener noreferrer">VoIP</a> 最主要的信令协议之一。</p>
<ul>
<li><a href="https://www.antisip.com/" target="_blank" rel="noopener noreferrer">Antisip</a></li>
<li><a href="https://www.wikiwand.com/en/List_of_SIP_software" target="_blank" rel="noopener noreferrer">List of SIP software</a></li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="osip-vs-exosip">osip vs exosip<a href="#osip-vs-exosip" class="hash-link" aria-label="Direct link to osip vs exosip" title="Direct link to osip vs exosip">​</a></h3>
<blockquote>
<p>[!note]</p>
<ul>
<li>
<p><strong>osip</strong></p>
<p>oSIP is a <a href="https://www.wikiwand.com/en/Free_software" target="_blank" rel="noopener noreferrer">free software</a> library for <a href="https://www.wikiwand.com/en/VoIP" target="_blank" rel="noopener noreferrer">VoIP</a> applications implementing lower layers of <a href="https://www.wikiwand.com/en/Session_Initiation_Protocol" target="_blank" rel="noopener noreferrer">Session Initiation Protocol</a> (SIP).</p>
<p>oSIP 的开发开始于 2000 年 7 月，第一个版本在 2001 年 5 月发布。</p>
<p>oSIP 采用 ANSI C 编写，而且结构简单小巧，所以速度特别快。</p>
<p>它并不提供高层的 SIP 会话 控制 API，它主要提供一些解析 SIP/SDP 消息的 API 和事务处理的状态机。</p>
<p>oSIP 不提供任何快速产生请求消息和响应消息的方法，所有请求消息和响应消息的形成必须调用一组 sip message api 来手动组装完成，</p>
<p>oSIP 的作者还开发了基于 oSIP 的 UA <code>lib:exosip</code> 和 proxy server <code>lib:partysip</code></p>
<p>Software using oSIP</p>
<ul>
<li>eXosip, the “eXtended osip” library. An extension of oSIP for softphone implementation written by Aymeric Moizard.</li>
<li><a href="https://www.wikiwand.com/en/GNU_SIP_Witch" target="_blank" rel="noopener noreferrer">GNU SIP Witch</a></li>
</ul>
</li>
<li>
<p><strong>exosip</strong></p>
</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pjsip">pjsip<a href="#pjsip" class="hash-link" aria-label="Direct link to pjsip" title="Direct link to pjsip">​</a></h3>
<blockquote>
<p>[!note]</p>
<p>PJSIP 是一个开源的 SIP 协议库，它实现了 SIP、SDP、RTP、STUN、TURN 和 ICE。PJSIP 作为基于 SIP 的一个多媒体通信框架提供了非常清晰的 API，以及 NAT 穿越的功能。PJSIP 具有非常好的移植性，几乎支持现今所有系统：从桌面系统、嵌入式系统到智能手机。</p>
<p>PJSIP 同时支持语音、视频、状态呈现和即时通讯。PJSIP 具有非常完善的文档，对开发者非常友好。</p>
<p>PJSIP 由 Benny Prijono、Perry Ismangil 在 2005 年创建，之后不久，Nanang Izzuddin、Sauw Ming 加入开发团队。2006 年成立 Teluu Ltd.，成为开发和维护 PJSIP 的公司。PJSIP 采用双 License：GPLv2 以及商业许可证，开发者可以根据需要选择不同的 License。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sdpsession-description-protocol">SDP(Session Description Protocol)<a href="#sdpsession-description-protocol" class="hash-link" aria-label="Direct link to SDP(Session Description Protocol)" title="Direct link to SDP(Session Description Protocol)">​</a></h2>
<blockquote>
<p>[!note]</p>
<p>SDP 本身并不提供媒体服务，它只是描述了媒体服务在哪，以及如何和那个媒体服务打交道。</p>
<p>媒体传输相关的协议在 SIP 消息 SDP 段携带， 在服务器和客户端之间进行商议。</p>
<p>SDP 协议的具体内容参看：<a href="https://www.ietf.org/rfc/rfc2327.txt" target="_blank" rel="noopener noreferrer">RFC2327</a></p>
<p>由于 Web 端、IOS、Android、PC、MAC 端的差异性导致它们对音视频的支持能力不同， 所以我们进行一些音视频会话之前，需要交互下彼此的音视频编解码能力、网络带宽和传输协议等信息， 这些需要协商的信息需要用 SDP 来描述。</p>
<p>SDP 并不是传输协议，需要用 RTSP、SIP、HTTP 等协议进行承载传输、交换， 如果大家协调好了之后，就可以建立会话，完成真实的音视频码流传输，再完成解码和播放。</p>
<p>SDP 一般用在媒体会话建立之前，可以适用于实时流媒体、点播、直播等领域，特别在音视频通话、视频会议、VoIP、视频监控等领域应用较多。 媒体码流一般基于 RTP 传输，服务质量用 RTCP 协议保障。</p>
<p>但是 SDP 的交互不是所有音视频会话建立时都是必须的，假如双方提前约定好这些音视频会话创建需要的信息就不用这个步骤来交互彼此的 SDP 信息， 比如 HTTP-FLV、RTMP-FLV 直播和点播方案，因为一旦采用了这套方案，这些音视频会话建立需要的信息都是确定的， 但是这样会降低或者说没有充分发挥端到端的音视频能力，协商显得更加灵活点。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sdp作用">SDP作用<a href="#sdp作用" class="hash-link" aria-label="Direct link to SDP作用" title="Direct link to SDP作用">​</a></h3>
<p>SDP 作用包括以下一些方面</p>
<ul>
<li>建立会话的详细信息，包括名称，网络，带宽等信息</li>
<li>包含在会话中的媒体信息，包括：<!-- -->
<ul>
<li>媒体类型 (video, audio, etc)</li>
<li>传输协议 (RTP/UDP/IP, H.320, etc)</li>
<li>媒体格式 (H.261 video, MPEG video, etc)</li>
<li>多播或远端（单播）地址和端口</li>
</ul>
</li>
<li>为接收媒体而需的信息</li>
<li>使用的带宽信息</li>
<li>可信赖的接洽信息</li>
</ul>
<p>如果拓展，还可以描述会话的安全方案信息、服务质量信息等，其中 <code>WebRTC</code> 就在 SDP 的基础上进行了继续拓展</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="协议包格式protocol-sipsdp">协议包格式（Protocol: <code>SIP/SDP</code>）<a href="#协议包格式protocol-sipsdp" class="hash-link" aria-label="Direct link to 协议包格式protocol-sipsdp" title="Direct link to 协议包格式protocol-sipsdp">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 238: 633 bytes on wire (5064 bits), 633 bytes captured (5064 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 234]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 17]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport=5060;branch=z9hG4bK575396672;received=192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=139396672</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=403895202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 325396492</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 3 INVITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000001320000001@192.168.64.3:41073&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: application/sdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length:   191</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Session Description Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Description Protocol Version (v): 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Owner/Creator, Session Id (o): 34020000001320000001 1136 1136 IN IP4 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Name (s): Play</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection Information (c): IN IP4 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Time Description, active time (t): 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Description, name and address (m): video 15060 RTP/AVP 96</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): sendonly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): rtpmap:96 PS/90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): filesize:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Unknown: y=0200000001</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sip">SIP<a href="#sip" class="hash-link" aria-label="Direct link to SIP" title="Direct link to SIP">​</a></h2>
<blockquote>
<p>[!note]</p>
<p>SIP 协议使用 RTP 协议传送音视频数据流，使用 SDP 协议进行媒体描述。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="call-id">CALL-ID<a href="#call-id" class="hash-link" aria-label="Direct link to CALL-ID" title="Direct link to CALL-ID">​</a></h3>
<p>SIP 的一次通话，可以通过 <code>From</code>, <code>To</code>, <code>Call-ID</code> 三元组来区分。</p>
<p>CALL-ID 字段用于标识一个特定邀请以及与这个邀请相关的所有后续事务（即标识一个会话）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="包内容">包内容<a href="#包内容" class="hash-link" aria-label="Direct link to 包内容" title="Direct link to 包内容">​</a></h3>
<ul>
<li>Message</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (MESSAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: MESSAGE sip:34020000002000000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport;branch=z9hG4bK1013136823</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=676399389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000002000000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 1119613114</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 20 MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: Application/MANSCDP+xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length:   178</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;?xml version=&quot;1.0&quot; encoding=&quot;GB2312&quot;?&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Notify&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;CmdType&gt;Keepalive&lt;/CmdType&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;SN&gt;123&lt;/SN&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;DeviceID&gt;34020000001320000001&lt;/DeviceID&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Status&gt;OK&lt;/Status&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Info&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/Info&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/Notify&gt;\n</span><br></span></code></pre></div></div>
<ul>
<li>Bye</li>
</ul>
<p><strong>同一个会话，CSeq 要 +1</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Invite-&gt;100-&gt;200-&gt;Ack -&gt;Bye-&gt;200</span><br></span></code></pre></div></div>
<p>Bye 的包，From 和 To 要和 Ack 的一致（包括 <code>tag</code>），Call-ID 也要一致</p>
<ul>
<li>包字段</li>
</ul>
<p>MANSCDP 消息中的 SN 值用于与请求命令的匹配处理,响应命令中的 SN 值应使用请求命令中的 SN 值。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip-proxy">SIP Proxy<a href="#sip-proxy" class="hash-link" aria-label="Direct link to SIP Proxy" title="Direct link to SIP Proxy">​</a></h3>
<p>SIP Proxy 有分为两种模式，一种是状态代理模式，另外一种是无状态代理模式。</p>
<p>SIP 代理自己本身不能发起 <code>INVITE</code> 或者 <code>BYE</code> 请求，这样就不能满足 IP 语音通信的基本呼叫功能。</p>
<p>双方终端通过多个 Proxy 代理以后，根据 <code>Route Set</code> 返回处理流程。 但是，在一些情况下，如果终端忽略了 <code>Route Set</code> 以后，直接通过呼叫方和被呼叫方，双方可能进行非法呼叫， 它们跳过了代理服务器，导致业务控制层很难对其进行管理。</p>
<p>为了解决这个问题，引入了 <code>B2BUA</code> 机制，通过背靠背的方式来实现业务能力的管理和会话的管理。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="b2bua">B2BUA<a href="#b2bua" class="hash-link" aria-label="Direct link to B2BUA" title="Direct link to B2BUA">​</a></h3>
<p>B2BUA 是一个逻辑实体，它由一个 UAS 和一个 UAC 两个部分构成，分别负责接收请求，处理请求和生成请求。 B2BUA 和 SIP 代理不同，它必须保持在 dialog 中所有创建的请求。只有这样，B2BUA 才能完全控制所有需要管理的会话。</p>
<p>B2BUA 具体的构成如下：</p>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200623180051.png" alt="img" class="img_ev3q"></p>
<p>B2BUA 介于两个终端之间</p>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200624103643.png" alt="img" class="img_ev3q"></p>
<ol>
<li>UAC 对 B2BUA 发起一个 INVITE 请求，在 B2BUA 端，B2BUA 是一个 UAS 来接收这个请求，创建了第一个会话来管理这个请求。双方保存了彼此的 Route Set 记录消息。</li>
<li>为了对另外一个终端发起 INVITE 请求，B2BUA 同时也扮演了一个 UAC 的角色，它创建了第二个会话，并且再次对下游终端发起 INVITE 请求。这里，UAC 需要从 UAS 端拷贝 SDP 消息和其他必要消息内容。然后，UAC 对下游终端发起 INVITE 请求。终端接收了 INVITE 请求，并且保存了 Route Set 数据记录。</li>
<li>为了响应 INVITE 请求，这里，下游终端就会变成一个 UAS 回复 B2BUA 200 OK。B2BUA 再次拷贝 200 OK 的消息，然后通过 UAS 再次返回到 UAC 终端。</li>
<li>UAC 终端收到 200 OK 以后，保存为 Route Set 数据内容。</li>
</ol>
<p>如果计费模块检测到双方呼叫费用出现超额的时候，这时，B2BUA 会切换成 UAC/UAC 的状态，同时对终端发送 BYE 消息。</p>
<hr>
<h1>GB28181 协议解析</h1>
<p>点击在线查看标准完整文本： <a href="http://c.gb688.cn/bzgk/gb/showGb?type=online&amp;hcno=469659DC56B9B8187671FF08748CEC89" target="_blank" rel="noopener noreferrer">公共安全视频监控联网系统信息传输、交换、控制技术要求。</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="名词解释">名词解释<a href="#名词解释" class="hash-link" aria-label="Direct link to 名词解释" title="Direct link to 名词解释">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip-服务器">SIP 服务器<a href="#sip-服务器" class="hash-link" aria-label="Direct link to SIP 服务器" title="Direct link to SIP 服务器">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip-client">SIP client<a href="#sip-client" class="hash-link" aria-label="Direct link to SIP client" title="Direct link to SIP client">​</a></h3>
<p>具有注册登记、建立 / 终止会话连接、接收和播放视音频流等功能，主要包括用户界面、用户代理 (UA)、媒体解码模块和媒体通信模块。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip-device">SIP device<a href="#sip-device" class="hash-link" aria-label="Direct link to SIP device" title="Direct link to SIP device">​</a></h3>
<p>具有注册、建立 / 终止会话连接和控制、采集 / 编解码以及传送视音频流等的功能实体，主要包括用户代理 (UA)、媒体采集 / 编解码模块和媒体通信模块。</p>
<p>联网系统中 SIP 设备的实现形式主要有支持 SIP 协议的网络摄像机、视频编 / 解码设备、数字硬盘录像机 (DVR) 和报警设备等。若 SIP 设备具有多路视音频编解码通道，每个通道宜成为一个 SIP 逻辑 UA, 具有唯一的 SIPURI, 并向 SIP 服务器注册。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sip-监控域-sip-surveil-lance-realm">SIP 监控域 SIP surveil lance realm<a href="#sip-监控域-sip-surveil-lance-realm" class="hash-link" aria-label="Direct link to SIP 监控域 SIP surveil lance realm" title="Direct link to SIP 监控域 SIP surveil lance realm">​</a></h3>
<p>支持本标准规定的通信协议的监控网络，通常由 SIP 服务器和注册在 SIP 服务器上的监控资源、用户终端、网络等组成。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="注册服务器-register-server">注册服务器 register server<a href="#注册服务器-register-server" class="hash-link" aria-label="Direct link to 注册服务器 register server" title="Direct link to 注册服务器 register server">​</a></h3>
<p>IETF RFC 3261 规定的 SIP 逻辑实体，是具有接收注册请求、将请求中携带的信息进行保存并提供本域内位置服务的功能服务器。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="中心信令控制服务器-center-control-server">中心信令控制服务器 center control server<a href="#中心信令控制服务器-center-control-server" class="hash-link" aria-label="Direct link to 中心信令控制服务器 center control server" title="Direct link to 中心信令控制服务器 center control server">​</a></h3>
<p>具有向 SIP 客户端、SIP 设备、媒体服务器和网关提供注册、路由选择以及逻辑控制功能，并且提供接口与应用服务器通信。</p>
<p>组成中心信令控制的逻辑实体包括代理服务器、注册服务器、重定向服务器、背靠背用户代理等的一种或者几种，是负责核心 SIP 信令应用处理的 SIP 服务器。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="媒体服务器-media-server">媒体服务器 media server<a href="#媒体服务器-media-server" class="hash-link" aria-label="Direct link to 媒体服务器 media server" title="Direct link to 媒体服务器 media server">​</a></h3>
<p>提供实时媒体流的转发服务，提供媒体的存储、历史媒体信息的检索和点播服务。</p>
<p>媒体服务器接收来自 SIP 设备、网关或其他媒体服务器等设备的媒体数据，并根据指令，将这些数据转发到其他单个或者多个 SIP 客户端和媒体服务器。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="信令安全路由网关-secure-signal-routing-gateway">信令安全路由网关 secure signal routing gateway<a href="#信令安全路由网关-secure-signal-routing-gateway" class="hash-link" aria-label="Direct link to 信令安全路由网关 secure signal routing gateway" title="Direct link to 信令安全路由网关 secure signal routing gateway">​</a></h3>
<p>具有接收或转发域内外 SIP 信令功能，并且完成信令安全路由网关间路由信息的传递以及路由信令、信令身份标识的添加和鉴别等功能，是一种具有安全功能的 SIP 服务器。</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sip-监控域互联结构">SIP 监控域互联结构<a href="#sip-监控域互联结构" class="hash-link" aria-label="Direct link to SIP 监控域互联结构" title="Direct link to SIP 监控域互联结构">​</a></h2>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gb28181-通信协议结构">GB28181 通信协议结构<a href="#gb28181-通信协议结构" class="hash-link" aria-label="Direct link to GB28181 通信协议结构" title="Direct link to GB28181 通信协议结构">​</a></h2>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200624112224.png" alt="img" class="img_ev3q"></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="交互过程">交互过程<a href="#交互过程" class="hash-link" aria-label="Direct link to 交互过程" title="Direct link to 交互过程">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="客户端主动发起">客户端主动发起<a href="#客户端主动发起" class="hash-link" aria-label="Direct link to 客户端主动发起" title="Direct link to 客户端主动发起">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200605171529.png" alt="img" class="img_ev3q"></p>
<p>趣解：</p>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200605174748.png" alt="img" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="第三方呼叫控制">第三方呼叫控制<a href="#第三方呼叫控制" class="hash-link" aria-label="Direct link to 第三方呼叫控制" title="Direct link to 第三方呼叫控制">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200605171610.png" alt="img" class="img_ev3q"></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="编码规则">编码规则<a href="#编码规则" class="hash-link" aria-label="Direct link to 编码规则" title="Direct link to 编码规则">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="设备-id-通道-id"><code>设备 ID</code>, <code>通道 ID</code><a href="#设备-id-通道-id" class="hash-link" aria-label="Direct link to 设备-id-通道-id" title="Direct link to 设备-id-通道-id">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 一共 20 位</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">34020000001320000001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">省 市  区 单位 行业 设备类型 网络标识 设备序号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">34 02 00 00   00   132      0    000001</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200629104922.png" alt="img" class="img_ev3q"> <img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200629105015.png" alt="img" class="img_ev3q"> <img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200629105039.png" alt="img" class="img_ev3q"></p>
<h1>数据包</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="register">Register<a href="#register" class="hash-link" aria-label="Direct link to Register" title="Direct link to Register">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-register-no-auth">request: Register (no auth)<a href="#request-register-no-auth" class="hash-link" aria-label="Direct link to request: Register (no auth)" title="Direct link to request: Register (no auth)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2117: 442 bytes on wire (3536 bits), 442 bytes captured (3536 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (REGISTER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: REGISTER sip:34020000002000000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000002000000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: True]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Suspected resend of frame: 1613]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport;branch=z9hG4bK1935014795</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=496441511</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 1188137981</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 1 REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000001320000001@192.168.137.109:5060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Expires: 3600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-401">response: 401<a href="#response-401" class="hash-link" aria-label="Direct link to response: 401" title="Direct link to response: 401">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2121: 524 bytes on wire (4192 bits), 524 bytes captured (4192 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (401)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 401 Unauthorized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 401</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 1613]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 15594]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport=47918;received=192.168.64.3;branch=z9hG4bK1935014795</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=496441511</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=697042285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 1 REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 1188137981</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000002000000001@192.168.64.3:15060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        WWW-Authenticate: Digest realm=&quot;3402000000&quot;,qop=&quot;auth&quot;,nonce=&quot;a1b6ba00d8cbaa8ce99d1d39b2905d12&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-register-auth">request: register (auth)<a href="#request-register-auth" class="hash-link" aria-label="Direct link to request: register (auth)" title="Direct link to request: register (auth)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2122: 704 bytes on wire (5632 bits), 704 bytes captured (5632 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (REGISTER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: REGISTER sip:34020000002000000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000002000000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport;branch=z9hG4bK2038639153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=496441511</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 1188137981</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 2 REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000001320000001@192.168.137.109:5060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         [truncated]Authorization: Digest username=&quot;34020000001320000001&quot;, realm=&quot;3402000000&quot;, nonce=&quot;a1b6ba00d8cbaa8ce99d1d39b2905d12&quot;, uri=&quot;sip:34020000002000000001@3402000000&quot;, response=&quot;487b46591eae35a8d8f684db454ec471&quot;, algorithm=MD5, cnonce</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Expires: 3600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200609141735.png" alt="img" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-200">response: 200<a href="#response-200" class="hash-link" aria-label="Direct link to response: 200" title="Direct link to response: 200">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2123: 463 bytes on wire (3704 bits), 463 bytes captured (3704 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 2122]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 17]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport=60954;received=192.168.64.3;branch=z9hG4bK2038639153</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=496441511</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=410042311</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 2 REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 1188137981</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000002000000001@192.168.64.3:15060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Date: 2020-06-09T14:09:01.830</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Expires: 3600</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-1-binding">remove 1 binding<a href="#remove-1-binding" class="hash-link" aria-label="Direct link to remove 1 binding" title="Direct link to remove 1 binding">​</a></h3>
<p>有 remove 1 binding, 然后重新 register 的现象</p>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200609142346.png" alt="img" class="img_ev3q"></p>
<p>Message Header：</p>
<ul>
<li>CSeq 加 1，</li>
<li>Contact 的 <code>expires=0</code></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200609142442.png" alt="img" class="img_ev3q"></p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="message">Message<a href="#message" class="hash-link" aria-label="Direct link to Message" title="Direct link to Message">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-sip-server---ipc">request: sip server -&gt; ipc<a href="#request-sip-server---ipc" class="hash-link" aria-label="Direct link to request: sip server -&gt; ipc" title="Direct link to request: sip server -&gt; ipc">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2136: 571 bytes on wire (4568 bits), 571 bytes captured (4568 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (MESSAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: MESSAGE sip:34020000001320000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000001320000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport;branch=z9hG4bK268043391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=181043391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 44043391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 1 MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: Application/MANSCDP+xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\r\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Query&gt;\r\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;CmdType&gt;Catalog&lt;/CmdType&gt;\r\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;SN&gt;445043391&lt;/SN&gt;\r\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;DeviceID&gt;34020000001320000001&lt;/DeviceID&gt;\r\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/Query&gt;\r\n</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-ipc---sip-server">response: ipc -&gt; sip server<a href="#response-ipc---sip-server" class="hash-link" aria-label="Direct link to response: ipc -&gt; sip server" title="Direct link to response: ipc -&gt; sip server">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2137: 352 bytes on wire (2816 bits), 352 bytes captured (2816 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 2136]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport=5060;branch=z9hG4bK268043391;received=192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=181043391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=2000290983</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 44043391</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 1 MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-ipc---sip-server">request: ipc -&gt; sip server<a href="#request-ipc---sip-server" class="hash-link" aria-label="Direct link to request: ipc -&gt; sip server" title="Direct link to request: ipc -&gt; sip server">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2138: 1001 bytes on wire (8008 bits), 1001 bytes captured (8008 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (MESSAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: MESSAGE sip:34020000002000000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000002000000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport;branch=z9hG4bK461606833</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=106117409</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000002000000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 2113631911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 20 MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: Application/MANSCDP+xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length:   591</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;?xml version=&quot;1.0&quot; encoding=&quot;GB2312&quot;?&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Response&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;CmdType&gt;Catalog&lt;/CmdType&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;SN&gt;445043391&lt;/SN&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;DeviceID&gt;34020000001320000001&lt;/DeviceID&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;SumNum&gt;1&lt;/SumNum&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;DeviceList Num=&quot;1&quot;&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Item&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;DeviceID&gt;34020000001320000001&lt;/DeviceID&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Name&gt;Camera 01&lt;/Name&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Manufacturer&gt;Hikvision&lt;/Manufacturer&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Model&gt;IP Camera&lt;/Model&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Owner&gt;Owner&lt;/Owner&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;CivilCode&gt;3402000000&lt;/CivilCode&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Address&gt;Address&lt;/Address&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Parental&gt;0&lt;/Parental&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;ParentID&gt;34020000002000000001&lt;/ParentID&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;SafetyWay&gt;0&lt;/SafetyWay&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;RegisterWay&gt;1&lt;/RegisterWay&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Secrecy&gt;0&lt;/Secrecy&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;Status&gt;ON&lt;/Status&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/Item&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/DeviceList&gt;\n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/Response&gt;\n</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-sip-server---ipc-1">request: sip server -&gt; ipc<a href="#request-sip-server---ipc-1" class="hash-link" aria-label="Direct link to request: sip server -&gt; ipc" title="Direct link to request: sip server -&gt; ipc">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 2139: 360 bytes on wire (2880 bits), 360 bytes captured (2880 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 2138]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 16]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.137.109:5060;rport=60954;received=192.168.64.3;branch=z9hG4bK461606833</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000001320000001@3402000000&gt;;tag=106117409</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000002000000001@3402000000&gt;;tag=443043407</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 20 MESSAGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 2113631911</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="invite">Invite<a href="#invite" class="hash-link" aria-label="Direct link to Invite" title="Direct link to Invite">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-sip-server---ipc-sipsdp">request: sip server -&gt; ipc (SIP/SDP)<a href="#request-sip-server---ipc-sipsdp" class="hash-link" aria-label="Direct link to request: sip server -&gt; ipc (SIP/SDP)" title="Direct link to request: sip server -&gt; ipc (SIP/SDP)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 288: 746 bytes on wire (5968 bits), 746 bytes captured (5968 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (INVITE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: INVITE sip:34020000001320000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: INVITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000001320000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport;branch=z9hG4bK685516389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=171516389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 16516245</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 4 INVITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: APPLICATION/SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000002000000001@192.168.64.3:15060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Subject: 34020000001320000001:0200000001,34020000002020000001:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 226</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Session Description Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Description Protocol Version (v): 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Owner/Creator, Session Id (o): 34020000002000000001 0 0 IN IP4 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Name (s): Play</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection Information (c): IN IP4 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Time Description, active time (t): 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Description, name and address (m): video 30000 RTP/AVP 96 97 98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): recvonly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): rtpmap:96 PS/90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): rtpmap:97 MPEG4/90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): rtpmap:98 H264/90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Unknown: y=0200000001</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-100-trying-ipc---sip-server-sip">response: 100 Trying (ipc -&gt; sip server, SIP)<a href="#response-100-trying-ipc---sip-server-sip" class="hash-link" aria-label="Direct link to response: 100 Trying (ipc -&gt; sip server, SIP)" title="Direct link to response: 100 Trying (ipc -&gt; sip server, SIP)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 295: 340 bytes on wire (2720 bits), 340 bytes captured (2720 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 100 Trying</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 288]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 16]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport=5060;branch=z9hG4bK685516389;received=192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=171516389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 16516245</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 4 INVITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="response-200-ipc---sip-server-sipsdp">response: 200 (ipc -&gt; sip server, SIP/SDP)<a href="#response-200-ipc---sip-server-sipsdp" class="hash-link" aria-label="Direct link to response: 200 (ipc -&gt; sip server, SIP/SDP)" title="Direct link to response: 200 (ipc -&gt; sip server, SIP/SDP)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 297: 632 bytes on wire (5056 bits), 632 bytes captured (5056 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Status-Line: SIP/2.0 200 OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Status-Code: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 288]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 20]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport=5060;branch=z9hG4bK685516389;received=192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=171516389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=614786748</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 16516245</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 4 INVITE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000001320000001@192.168.64.3:55302&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Type: application/sdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: IP Camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length:   191</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Session Description Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Description Protocol Version (v): 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Owner/Creator, Session Id (o): 34020000001320000001 2346 2346 IN IP4 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Session Name (s): Play</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Connection Information (c): IN IP4 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Time Description, active time (t): 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Description, name and address (m): video 15060 RTP/AVP 96</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): sendonly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): rtpmap:96 PS/90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Media Attribute (a): filesize:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Unknown: y=0200000001</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ack">ACK<a href="#ack" class="hash-link" aria-label="Direct link to ACK" title="Direct link to ACK">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-sip-server---ipc-sip">request: sip server -&gt; ipc (SIP)<a href="#request-sip-server---ipc-sip" class="hash-link" aria-label="Direct link to request: sip server -&gt; ipc (SIP)" title="Direct link to request: sip server -&gt; ipc (SIP)">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 298: 430 bytes on wire (3440 bits), 430 bytes captured (3440 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: Apple_70:23:0d (88:e9:fe:70:23:0d), Dst: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.105, Dst: 192.168.137.109</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 5060, Dst Port: 5060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Session Initiation Protocol (ACK)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Request-Line: ACK sip:34020000001320000001@3402000000 SIP/2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Method: ACK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Request-URI: sip:34020000001320000001@3402000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Resent Packet: False]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Request Frame: 288]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [Response Time (ms): 61]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Message Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Via: SIP/2.0/UDP 192.168.64.3:15060;rport;branch=z9hG4bK193516446</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        From: &lt;sip:34020000002000000001@3402000000&gt;;tag=171516389</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        To: &lt;sip:34020000001320000001@3402000000&gt;;tag=614786748</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Call-ID: 16516245</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CSeq: 4 ACK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Contact: &lt;sip:34020000002000000001@192.168.64.3:15060&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Max-Forwards: 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        User-Agent: LiveGBS v200603</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Content-Length: 0</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rtp">RTP<a href="#rtp" class="hash-link" aria-label="Direct link to RTP" title="Direct link to RTP">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ipc---sip-server">ipc -&gt; sip server<a href="#ipc---sip-server" class="hash-link" aria-label="Direct link to ipc -&gt; sip server" title="Direct link to ipc -&gt; sip server">​</a></h3>
<p><code>Sequence number</code> 递增</p>
<p><img decoding="async" loading="lazy" src="https://cdn.jsdelivr.net/gh/ikingye/imagehost/picgo/20200609143948.png" alt="img" class="img_ev3q"></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Frame 299: 1454 bytes on wire (11632 bits), 1454 bytes captured (11632 bits) on interface 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ethernet II, Src: 98:df:82:6d:9e:52 (98:df:82:6d:9e:52), Dst: Apple_70:23:0d (88:e9:fe:70:23:0d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Internet Protocol Version 4, Src: 192.168.137.109, Dst: 192.168.137.105</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User Datagram Protocol, Src Port: 15060, Dst Port: 30000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Real-Time Transport Protocol</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Stream setup by SDP (frame 288)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    10.. .... = Version: RFC 1889 Version (2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ..0. .... = Padding: False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...0 .... = Extension: False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .... 0000 = Contributing source identifiers count: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0... .... = Marker: False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Payload type: PS (96)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sequence number: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Extended sequence number: 65536]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Timestamp: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Synchronization Source identifier: 0x0bebc201 (200000001)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Payload: 000001ba6e617c97940107599ffeffff01f2c2b4000001bb...</span><br></span></code></pre></div></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" title="Learn tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/learn">Learn</a></li><li class="tag_QGVx"><a rel="tag" title="Note tag description" class="tag_zVej tagRegular_sFm0" href="/blog/tags/note">Note</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/WangQuanWWQ/my-blog/tree/master/blog/2025-07-10-流媒体.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2025/07/10/创建git笔记仓库"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">创建git笔记仓库</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ffmpeg" class="table-of-contents__link toc-highlight">ffmpeg</a></li><li><a href="#gb28181" class="table-of-contents__link toc-highlight">GB28181</a><ul><li><a href="#gb28181-报文" class="table-of-contents__link toc-highlight">GB28181 报文</a></li><li><a href="#gb28181的协议栈实现" class="table-of-contents__link toc-highlight">GB28181的协议栈实现</a></li><li><a href="#sip协议" class="table-of-contents__link toc-highlight">SIP协议</a></li><li><a href="#osip-vs-exosip" class="table-of-contents__link toc-highlight">osip vs exosip</a></li><li><a href="#pjsip" class="table-of-contents__link toc-highlight">pjsip</a></li></ul></li><li><a href="#sdpsession-description-protocol" class="table-of-contents__link toc-highlight">SDP(Session Description Protocol)</a><ul><li><a href="#sdp作用" class="table-of-contents__link toc-highlight">SDP作用</a></li><li><a href="#协议包格式protocol-sipsdp" class="table-of-contents__link toc-highlight">协议包格式（Protocol: <code>SIP/SDP</code>）</a></li></ul></li><li><a href="#sip" class="table-of-contents__link toc-highlight">SIP</a><ul><li><a href="#call-id" class="table-of-contents__link toc-highlight">CALL-ID</a></li><li><a href="#包内容" class="table-of-contents__link toc-highlight">包内容</a></li><li><a href="#sip-proxy" class="table-of-contents__link toc-highlight">SIP Proxy</a></li><li><a href="#b2bua" class="table-of-contents__link toc-highlight">B2BUA</a></li></ul></li><li><a href="#名词解释" class="table-of-contents__link toc-highlight">名词解释</a><ul><li><a href="#sip-服务器" class="table-of-contents__link toc-highlight">SIP 服务器</a></li><li><a href="#sip-client" class="table-of-contents__link toc-highlight">SIP client</a></li><li><a href="#sip-device" class="table-of-contents__link toc-highlight">SIP device</a></li><li><a href="#sip-监控域-sip-surveil-lance-realm" class="table-of-contents__link toc-highlight">SIP 监控域 SIP surveil lance realm</a></li><li><a href="#注册服务器-register-server" class="table-of-contents__link toc-highlight">注册服务器 register server</a></li><li><a href="#中心信令控制服务器-center-control-server" class="table-of-contents__link toc-highlight">中心信令控制服务器 center control server</a></li><li><a href="#媒体服务器-media-server" class="table-of-contents__link toc-highlight">媒体服务器 media server</a></li><li><a href="#信令安全路由网关-secure-signal-routing-gateway" class="table-of-contents__link toc-highlight">信令安全路由网关 secure signal routing gateway</a></li></ul></li><li><a href="#sip-监控域互联结构" class="table-of-contents__link toc-highlight">SIP 监控域互联结构</a></li><li><a href="#gb28181-通信协议结构" class="table-of-contents__link toc-highlight">GB28181 通信协议结构</a></li><li><a href="#交互过程" class="table-of-contents__link toc-highlight">交互过程</a><ul><li><a href="#客户端主动发起" class="table-of-contents__link toc-highlight">客户端主动发起</a></li><li><a href="#第三方呼叫控制" class="table-of-contents__link toc-highlight">第三方呼叫控制</a></li></ul></li><li><a href="#编码规则" class="table-of-contents__link toc-highlight">编码规则</a><ul><li><a href="#设备-id-通道-id" class="table-of-contents__link toc-highlight"><code>设备 ID</code>, <code>通道 ID</code></a></li></ul></li><li><a href="#register" class="table-of-contents__link toc-highlight">Register</a><ul><li><a href="#request-register-no-auth" class="table-of-contents__link toc-highlight">request: Register (no auth)</a></li><li><a href="#response-401" class="table-of-contents__link toc-highlight">response: 401</a></li><li><a href="#request-register-auth" class="table-of-contents__link toc-highlight">request: register (auth)</a></li><li><a href="#response-200" class="table-of-contents__link toc-highlight">response: 200</a></li><li><a href="#remove-1-binding" class="table-of-contents__link toc-highlight">remove 1 binding</a></li></ul></li><li><a href="#message" class="table-of-contents__link toc-highlight">Message</a><ul><li><a href="#request-sip-server---ipc" class="table-of-contents__link toc-highlight">request: sip server -&gt; ipc</a></li><li><a href="#response-ipc---sip-server" class="table-of-contents__link toc-highlight">response: ipc -&gt; sip server</a></li><li><a href="#request-ipc---sip-server" class="table-of-contents__link toc-highlight">request: ipc -&gt; sip server</a></li><li><a href="#request-sip-server---ipc-1" class="table-of-contents__link toc-highlight">request: sip server -&gt; ipc</a></li></ul></li><li><a href="#invite" class="table-of-contents__link toc-highlight">Invite</a><ul><li><a href="#request-sip-server---ipc-sipsdp" class="table-of-contents__link toc-highlight">request: sip server -&gt; ipc (SIP/SDP)</a></li><li><a href="#response-100-trying-ipc---sip-server-sip" class="table-of-contents__link toc-highlight">response: 100 Trying (ipc -&gt; sip server, SIP)</a></li><li><a href="#response-200-ipc---sip-server-sipsdp" class="table-of-contents__link toc-highlight">response: 200 (ipc -&gt; sip server, SIP/SDP)</a></li></ul></li><li><a href="#ack" class="table-of-contents__link toc-highlight">ACK</a><ul><li><a href="#request-sip-server---ipc-sip" class="table-of-contents__link toc-highlight">request: sip server -&gt; ipc (SIP)</a></li></ul></li><li><a href="#rtp" class="table-of-contents__link toc-highlight">RTP</a><ul><li><a href="#ipc---sip-server" class="table-of-contents__link toc-highlight">ipc -&gt; sip server</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>